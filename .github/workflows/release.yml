name: Tag Release
on:
  push:
    tags:
    - "v*"

jobs:
  frontend:
    name: Build frontend
    runs-on: ubuntu-20.04
    steps:
    - name: get change log file
      run: |
        version=$(echo ${github.ref_name:1})
        version=`echo $version | sed 's/-/./g'`
        major=`echo $version | cut -d. -f1`
        minor=`echo $version | cut -d. -f2`
        echo "version_file=CHANGELOG/CHANGELOG-$major.$minor.md" >> $GITHUB_ENV
    - name: Create Release
      ## 创建release
      id: create_release
      uses: ncipollo/release-action@v1.12.0
      with:
        name: "bk-ci ${{ github.ref_name }}"
        draft: true
        prerelease: true
        token: ${{ secrets.GITHUB_TOKEN }}
        body: "See <a href='https://github.com/TencentBlueKing/bk-ci/blob/master/${{ version_file }}'>the CHANGELOG</a> for more details."
