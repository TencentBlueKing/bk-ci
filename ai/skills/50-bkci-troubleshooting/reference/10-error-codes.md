# BK-CI 错误码参考手册

## 错误码格式

BK-CI 错误码采用统一格式：`模块代码` + `错误类型` + `序号`

```
2101001
│││└─── 序号 (001-999)
││└──── 错误类型 (0-9)
│└───── 模块代码 (01-99)
└────── 系统标识 (2=BK-CI)
```

---

## 通用错误码 (210xxxx)

| 错误码 | 说明 | 可能原因 | 解决方案 |
|--------|------|----------|----------|
| 2100001 | 系统内部错误 | 未捕获的异常 | 查看详细日志定位 |
| 2100002 | 参数校验失败 | 请求参数不合法 | 检查请求参数格式 |
| 2100003 | 资源不存在 | ID 无效或已删除 | 确认资源是否存在 |
| 2100004 | 无权限操作 | 权限不足 | 申请相应权限 |
| 2100005 | 操作频率限制 | 请求过于频繁 | 降低请求频率 |
| 2100006 | 服务不可用 | 依赖服务异常 | 检查依赖服务状态 |
| 2100007 | 数据库错误 | DB 连接/查询失败 | 检查数据库状态 |
| 2100008 | 缓存错误 | Redis 连接失败 | 检查 Redis 状态 |

---

## Project 模块 (211xxxx)

| 错误码 | 说明 | 可能原因 | 解决方案 |
|--------|------|----------|----------|
| 2110001 | 项目不存在 | projectId 无效 | 确认项目 ID |
| 2110002 | 项目已存在 | 项目名称重复 | 使用其他名称 |
| 2110003 | 项目已禁用 | 项目被停用 | 联系管理员启用 |
| 2110004 | 项目成员已存在 | 重复添加成员 | 忽略或更新权限 |
| 2110005 | 非项目成员 | 用户不在项目中 | 添加为项目成员 |
| 2110006 | 项目配额超限 | 资源配额不足 | 申请增加配额 |

---

## Process 模块 - 流水线 (212xxxx)

| 错误码 | 说明 | 可能原因 | 解决方案 |
|--------|------|----------|----------|
| 2120001 | 流水线不存在 | pipelineId 无效 | 确认流水线 ID |
| 2120002 | 流水线已存在 | 名称重复 | 使用其他名称 |
| 2120003 | 流水线已锁定 | 正在编辑中 | 等待或强制解锁 |
| 2120004 | 流水线已删除 | 已被删除 | 从回收站恢复 |
| 2120005 | 流水线版本冲突 | 并发修改 | 刷新后重试 |
| 2120006 | 流水线模型无效 | YAML/JSON 格式错误 | 检查模型格式 |
| 2120007 | Stage 不存在 | stageId 无效 | 确认 Stage ID |
| 2120008 | Job 不存在 | containerId 无效 | 确认 Job ID |
| 2120009 | Task 不存在 | taskId 无效 | 确认 Task ID |
| 2120010 | 流水线数量超限 | 超过项目配额 | 删除无用流水线 |

---

## Process 模块 - 构建 (213xxxx)

| 错误码 | 说明 | 可能原因 | 解决方案 |
|--------|------|----------|----------|
| 2130001 | 构建不存在 | buildId 无效 | 确认构建 ID |
| 2130002 | 构建已取消 | 用户取消 | 重新触发构建 |
| 2130003 | 构建已完成 | 无法操作已结束构建 | 触发新构建 |
| 2130004 | 构建排队中 | 等待资源 | 等待或取消 |
| 2130005 | 并发构建超限 | 超过并发限制 | 等待或提高限制 |
| 2130006 | 构建超时 | 执行时间过长 | 优化或增加超时 |
| 2130007 | 构建参数无效 | 启动参数错误 | 检查参数配置 |
| 2130008 | 触发条件不满足 | 触发器条件未满足 | 检查触发配置 |
| 2130009 | 手动审核等待 | 等待人工审核 | 完成审核操作 |
| 2130010 | 质量红线拦截 | 未通过质量检查 | 修复质量问题 |

---

## Repository 模块 (214xxxx)

| 错误码 | 说明 | 可能原因 | 解决方案 |
|--------|------|----------|----------|
| 2140001 | 代码库不存在 | repositoryId 无效 | 确认代码库 ID |
| 2140002 | 代码库已存在 | URL 重复 | 使用已有代码库 |
| 2140003 | 凭证无效 | 认证信息错误 | 更新凭证 |
| 2140004 | 代码库不可达 | 网络问题 | 检查网络连接 |
| 2140005 | 分支不存在 | 分支名无效 | 确认分支名称 |
| 2140006 | 提交不存在 | commitId 无效 | 确认提交 ID |
| 2140007 | Webhook 配置失败 | 无权限配置 | 检查仓库权限 |

---

## Dispatch 模块 (215xxxx)

| 错误码 | 说明 | 可能原因 | 解决方案 |
|--------|------|----------|----------|
| 2150001 | 无可用构建机 | 所有 Agent 离线 | 检查 Agent 状态 |
| 2150002 | 构建机资源不足 | CPU/内存/磁盘不足 | 清理或扩容 |
| 2150003 | 构建机类型不匹配 | 无匹配的构建环境 | 检查环境配置 |
| 2150004 | 构建机已锁定 | 被其他任务占用 | 等待释放 |
| 2150005 | 容器启动失败 | Docker 问题 | 检查 Docker 状态 |
| 2150006 | 镜像拉取失败 | 镜像不存在或网络问题 | 检查镜像配置 |
| 2150007 | 任务分发超时 | Agent 响应慢 | 检查 Agent 负载 |

---

## Store 模块 (216xxxx)

| 错误码 | 说明 | 可能原因 | 解决方案 |
|--------|------|----------|----------|
| 2160001 | 插件不存在 | atomCode 无效 | 确认插件标识 |
| 2160002 | 插件版本不存在 | 版本号无效 | 确认版本号 |
| 2160003 | 插件未发布 | 处于测试状态 | 等待发布 |
| 2160004 | 插件已下架 | 被下架处理 | 联系插件作者 |
| 2160005 | 无插件使用权限 | 未安装或无权限 | 安装插件 |
| 2160006 | 插件执行失败 | 运行时错误 | 查看执行日志 |
| 2160007 | 模板不存在 | templateId 无效 | 确认模板 ID |
| 2160008 | 镜像不存在 | imageCode 无效 | 确认镜像标识 |

---

## Artifactory 模块 (217xxxx)

| 错误码 | 说明 | 可能原因 | 解决方案 |
|--------|------|----------|----------|
| 2170001 | 文件不存在 | 路径无效 | 确认文件路径 |
| 2170002 | 文件已存在 | 路径冲突 | 使用其他路径 |
| 2170003 | 存储空间不足 | 磁盘已满 | 清理或扩容 |
| 2170004 | 文件过大 | 超过大小限制 | 压缩或分片 |
| 2170005 | 上传失败 | 网络中断 | 重试上传 |
| 2170006 | 下载失败 | 文件损坏 | 重新上传 |
| 2170007 | 制品已过期 | 超过保留期 | 重新生成 |

---

## Environment 模块 (218xxxx)

| 错误码 | 说明 | 可能原因 | 解决方案 |
|--------|------|----------|----------|
| 2180001 | 环境不存在 | envId 无效 | 确认环境 ID |
| 2180002 | 节点不存在 | nodeId 无效 | 确认节点 ID |
| 2180003 | Agent 未安装 | 节点无 Agent | 安装 Agent |
| 2180004 | Agent 离线 | 心跳超时 | 检查 Agent 进程 |
| 2180005 | Agent 版本过低 | 需要升级 | 升级 Agent |
| 2180006 | 节点已存在 | IP 重复 | 使用已有节点 |

---

## Ticket 模块 (219xxxx)

| 错误码 | 说明 | 可能原因 | 解决方案 |
|--------|------|----------|----------|
| 2190001 | 凭证不存在 | credentialId 无效 | 确认凭证 ID |
| 2190002 | 凭证类型不匹配 | 使用方式错误 | 检查凭证类型 |
| 2190003 | 凭证已过期 | Token 失效 | 更新凭证 |
| 2190004 | 无凭证使用权限 | 未授权 | 申请权限 |
| 2190005 | 证书不存在 | certId 无效 | 确认证书 ID |

---

## Auth 模块 (220xxxx)

| 错误码 | 说明 | 可能原因 | 解决方案 |
|--------|------|----------|----------|
| 2200001 | 用户未登录 | Token 无效 | 重新登录 |
| 2200002 | Token 已过期 | 会话超时 | 刷新 Token |
| 2200003 | 无资源权限 | 权限不足 | 申请权限 |
| 2200004 | 用户不存在 | userId 无效 | 确认用户 ID |
| 2200005 | 用户组不存在 | groupId 无效 | 确认用户组 ID |
| 2200006 | OAuth 认证失败 | 第三方认证错误 | 检查 OAuth 配置 |

---

## Quality 模块 (221xxxx)

| 错误码 | 说明 | 可能原因 | 解决方案 |
|--------|------|----------|----------|
| 2210001 | 规则不存在 | ruleId 无效 | 确认规则 ID |
| 2210002 | 指标不存在 | indicatorId 无效 | 确认指标 ID |
| 2210003 | 红线检查失败 | 未达到质量标准 | 修复代码问题 |
| 2210004 | 元数据缺失 | 未上报指标数据 | 检查插件配置 |

---

## HTTP 状态码对照

| HTTP 状态码 | 含义 | 常见场景 |
|-------------|------|----------|
| 400 | 请求参数错误 | 参数格式不正确 |
| 401 | 未认证 | Token 无效或过期 |
| 403 | 无权限 | 权限不足 |
| 404 | 资源不存在 | ID 无效 |
| 409 | 资源冲突 | 并发修改 |
| 429 | 请求过多 | 触发限流 |
| 500 | 服务器错误 | 内部异常 |
| 502 | 网关错误 | 后端服务不可用 |
| 503 | 服务不可用 | 服务过载 |
| 504 | 网关超时 | 后端响应超时 |

---

## 错误排查流程

```
收到错误码
    │
    ├─ 查找错误码含义
    │
    ├─ 确定所属模块
    │
    ├─ 查看对应日志
    │   └─ /data/bkci/logs/ci/{module}/{module}-devops.log
    │
    ├─ 根据解决方案处理
    │
    └─ 如无法解决，收集信息提交工单
        ├─ 错误码
        ├─ 请求 ID (X-DEVOPS-RID)
        ├─ 时间戳
        └─ 相关日志
```
