# 项目与权限管理

## 概述

项目是 BK-CI 中的顶级组织单元，提供资源隔离和权限管理。本章将详细介绍如何创建和管理项目，以及如何配置用户权限和角色。

## 项目管理

### 创建项目

#### 1. 访问项目管理
```
导航路径: 首页 → 项目管理 → 创建项目
```

#### 2. 填写项目信息

**基本信息**:
- **项目名称**: 项目的显示名称（支持中文）
- **项目英文名**: 项目的唯一标识（仅支持英文、数字、下划线）
- **项目描述**: 项目的详细说明
- **项目类型**: 选择项目类型（普通项目/敏捷项目）

**配置示例**:
```yaml
项目名称: 移动端应用
项目英文名: mobile-app
项目描述: 公司移动端应用的 CI/CD 项目
项目类型: 普通项目
```

#### 3. 项目配置

**高级设置**:
- **项目可见性**: 公开/私有
- **项目标签**: 用于项目分类和检索
- **项目图标**: 自定义项目图标
- **项目颜色**: 项目主题色

### 项目基础配置

#### 1. 项目信息设置

**路径**: `项目设置 → 基础信息`

**可配置项**:
```yaml
基础信息:
  项目名称: 可修改显示名称
  项目描述: 更新项目说明
  项目标签: 添加分类标签
  
显示设置:
  项目图标: 上传自定义图标
  项目颜色: 设置主题色
  
高级设置:
  项目可见性: 公开/私有
  项目状态: 启用/禁用
```

#### 2. 项目服务配置

**路径**: `项目设置 → 服务配置`

**服务开关**:
- **代码库服务**: 启用代码库管理功能
- **流水线服务**: 启用 CI/CD 流水线功能  
- **制品库服务**: 启用制品存储功能
- **环境管理服务**: 启用构建环境管理
- **研发商店服务**: 启用插件和模板商店

**配置示例**:
```yaml
服务配置:
  代码库服务: ✅ 启用
  流水线服务: ✅ 启用
  制品库服务: ✅ 启用
  环境管理服务: ✅ 启用
  研发商店服务: ✅ 启用
  质量红线服务: ✅ 启用
  通知服务: ✅ 启用
```

## 权限管理

### 权限模型

BK-CI 采用 RBAC（基于角色的访问控制）模型：

```
用户 (User) → 角色 (Role) → 权限 (Permission) → 资源 (Resource)
```

#### 权限层级

```
项目级权限
├── 项目管理权限
│   ├── 项目查看
│   ├── 项目编辑
│   └── 项目删除
├── 流水线权限
│   ├── 流水线查看
│   ├── 流水线创建
│   ├── 流水线编辑
│   ├── 流水线执行
│   └── 流水线删除
├── 代码库权限
│   ├── 代码库查看
│   ├── 代码库关联
│   └── 代码库管理
└── 制品库权限
    ├── 制品查看
    ├── 制品上传
    └── 制品下载
```

### 预定义角色

#### 1. 项目管理员 (Project Admin)
**权限范围**: 项目内所有权限
```yaml
权限列表:
  - 项目管理: 完全权限
  - 用户管理: 完全权限
  - 流水线管理: 完全权限
  - 代码库管理: 完全权限
  - 制品库管理: 完全权限
  - 环境管理: 完全权限
```

#### 2. 开发人员 (Developer)
**权限范围**: 开发相关权限
```yaml
权限列表:
  - 项目查看: ✅
  - 流水线查看: ✅
  - 流水线创建: ✅
  - 流水线编辑: ✅ (自己创建的)
  - 流水线执行: ✅
  - 代码库查看: ✅
  - 制品库查看: ✅
  - 制品库上传: ✅
```

#### 3. 测试人员 (Tester)
**权限范围**: 测试相关权限
```yaml
权限列表:
  - 项目查看: ✅
  - 流水线查看: ✅
  - 流水线执行: ✅ (测试流水线)
  - 制品库查看: ✅
  - 制品库下载: ✅
  - 环境查看: ✅
```

#### 4. 访客 (Viewer)
**权限范围**: 只读权限
```yaml
权限列表:
  - 项目查看: ✅
  - 流水线查看: ✅
  - 构建历史查看: ✅
  - 制品库查看: ✅
```

### 用户管理

#### 1. 添加用户

**路径**: `项目设置 → 用户管理 → 添加用户`

**操作步骤**:
1. 点击"添加用户"按钮
2. 输入用户名或选择用户
3. 分配角色
4. 确认添加

**批量添加**:
```yaml
批量添加方式:
  - 用户名列表: 逐行输入用户名
  - 文件导入: 上传 CSV 文件
  - 组织架构: 从组织架构选择
```

#### 2. 角色分配

**分配原则**:
- 最小权限原则：只分配必要的权限
- 职责分离：不同角色承担不同职责
- 定期审查：定期检查和调整权限

**分配示例**:
```yaml
团队角色分配:
  项目经理: 项目管理员
  技术负责人: 项目管理员
  后端开发: 开发人员
  前端开发: 开发人员
  测试工程师: 测试人员
  运维工程师: 开发人员 + 环境管理权限
  实习生: 访客
```

#### 3. 权限审计

**审计内容**:
- 用户权限列表
- 权限变更记录
- 异常权限检查
- 权限使用统计

**审计报告**:
```yaml
权限审计报告:
  用户总数: 25
  管理员数量: 3
  开发人员数量: 15
  测试人员数量: 5
  访客数量: 2
  
权限异常:
  - 长期未登录用户: 2 人
  - 权限过高用户: 1 人
  - 重复权限: 0 处
```

### 自定义角色

#### 1. 创建自定义角色

**路径**: `项目设置 → 角色管理 → 创建角色`

**配置步骤**:
1. 填写角色基本信息
2. 选择权限范围
3. 配置具体权限
4. 保存角色

**角色配置示例**:
```yaml
角色名称: 发布管理员
角色描述: 负责生产环境发布的专门角色
权限配置:
  项目权限:
    - 项目查看: ✅
  流水线权限:
    - 流水线查看: ✅
    - 流水线执行: ✅ (仅发布流水线)
  制品库权限:
    - 制品查看: ✅
    - 制品下载: ✅
  环境权限:
    - 生产环境管理: ✅
```

#### 2. 权限组合策略

**常见权限组合**:

| 角色类型 | 项目 | 流水线 | 代码库 | 制品库 | 环境 |
|----------|------|--------|--------|--------|------|
| 只读用户 | 查看 | 查看 | 查看 | 查看 | 查看 |
| 开发用户 | 查看 | 创建/编辑/执行 | 查看/关联 | 查看/上传 | 查看 |
| 测试用户 | 查看 | 查看/执行 | 查看 | 查看/下载 | 查看/测试环境 |
| 运维用户 | 查看 | 查看/执行 | 查看 | 查看/下载 | 完全权限 |
| 管理用户 | 完全权限 | 完全权限 | 完全权限 | 完全权限 | 完全权限 |

### 权限控制最佳实践

#### 1. 权限设计原则

**最小权限原则**:
- 用户只获得完成工作所需的最小权限
- 定期审查和回收不必要的权限
- 使用临时权限处理特殊需求

**职责分离原则**:
- 开发和运维权限分离
- 测试和生产环境权限分离
- 审批和执行权限分离

#### 2. 权限管理流程

**权限申请流程**:
```
用户申请权限
    ↓
直属领导审批
    ↓
项目管理员审批
    ↓
权限分配
    ↓
权限生效通知
```

**权限回收流程**:
```
权限到期/离职
    ↓
自动/手动触发回收
    ↓
权限禁用
    ↓
权限清理
    ↓
回收确认
```

#### 3. 安全建议

**账号安全**:
- 启用双因子认证
- 定期更换密码
- 监控异常登录

**权限安全**:
- 定期权限审计
- 权限变更记录
- 异常权限告警

**操作安全**:
- 关键操作审批
- 操作日志记录
- 异常操作监控

## 项目协作

### 团队协作模式

#### 1. 集中式协作
**适用场景**: 小型团队，统一管理
```yaml
协作特点:
  - 项目管理员统一管理
  - 开发人员权限相同
  - 流水线集中维护
  
权限配置:
  - 1-2 个项目管理员
  - 其他成员为开发人员角色
```

#### 2. 分布式协作
**适用场景**: 大型团队，分模块管理
```yaml
协作特点:
  - 按模块分配管理员
  - 不同模块权限隔离
  - 流水线分模块维护
  
权限配置:
  - 总项目管理员 1 人
  - 模块管理员 2-3 人
  - 模块开发人员若干
```

### 跨项目协作

#### 1. 项目间权限
**场景**: 需要访问其他项目资源
```yaml
解决方案:
  - 跨项目用户添加
  - 制品库跨项目授权
  - API 接口调用授权
```

#### 2. 资源共享
**场景**: 多项目共享构建环境或制品
```yaml
共享策略:
  - 公共构建机池
  - 共享制品库
  - 公共插件和模板
```

## 常见问题

### 权限问题

**Q: 用户无法查看流水线**
```yaml
排查步骤:
  1. 确认用户是否在项目中
  2. 检查用户角色权限
  3. 验证流水线权限设置
  4. 检查项目可见性配置
```

**Q: 无法执行流水线**
```yaml
可能原因:
  - 缺少流水线执行权限
  - 构建机权限不足
  - 代码库访问权限问题
  - 制品库上传权限问题
```

### 管理问题

**Q: 如何批量管理用户权限**
```yaml
解决方案:
  1. 使用角色批量分配
  2. 导入用户列表
  3. 使用 API 批量操作
  4. 组织架构同步
```

**Q: 如何处理离职人员权限**
```yaml
处理流程:
  1. 立即禁用账号
  2. 回收所有权限
  3. 转移相关资源
  4. 清理访问记录
```

## 下一步

完成项目和权限配置后，建议继续学习：

1. [代码库接入与管理](./03-repository-management-guide.md) - 接入代码库
2. [流水线创建与配置](./04-pipeline-creation-guide.md) - 创建流水线
3. [构建环境与执行](./05-build-environment-guide.md) - 配置构建环境

---

*本章介绍了项目创建和权限管理的完整流程，为团队协作奠定基础。*