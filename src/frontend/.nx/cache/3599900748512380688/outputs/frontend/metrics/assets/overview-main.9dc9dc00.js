import{h as S,S as W,u as K,B as Q,M as J}from"./bk-chart.min.e4cb5b29.js";import{d as x,u as P,r as R,o as C,c as k,g as r,e as a,w as b,h as _,t as l,i as G,j as T,k as L,l as $,m as H,b as o,p as w,q as X,s as Z,v as q,x as M,y as I,z as V,f as D,F as U}from"./index.5d40bf3f.js";import{_ as B}from"./plugin-vue_export-helper.21dcd24c.js";import{d as O,i as E}from"./duration.da19db5d.js";const N={status:Object,resetBtnDisabled:Boolean};const ee={class:"main-filter"},te=x({__name:"overview-filter",props:N,emits:["change"],setup(m,{emit:v}){const{t}=P(),{handleChange:i,handleTimeChange:e}=K(v),d=()=>{i({pipelineIds:[],pipelineLabelIds:[],startTime:"",endTime:""})},p=u=>u&&u.getTime()>Date.now();return(u,n)=>{const c=R("bk-date-picker"),s=R("bk-button");return C(),k("section",ee,[r(a(W),{class:"mr8 w240","id-key":"pipelineId","name-key":"pipelineName",placeholder:a(t)("Pipelines"),multiple:!0,"api-method":a(S).getPipelineList,"select-value":u.status.pipelineIds,onChange:n[0]||(n[0]=g=>a(i)({pipelineIds:g}))},null,8,["placeholder","api-method","select-value"]),r(a(W),{class:"mr8 w240","id-key":"labelId","name-key":"labelName",placeholder:a(t)("Pipeline Lable"),multiple:!0,"api-method":a(S).getPipelineLabels,"select-value":u.status.pipelineLabelIds,onChange:n[1]||(n[1]=g=>a(i)({pipelineLabelIds:g}))},null,8,["placeholder","api-method","select-value"]),r(c,{class:"mr16 w240",type:"daterange","disable-date":p,"model-value":[u.status.startTime,u.status.endTime],onChange:a(e)},null,8,["model-value","onChange"]),r(s,{disabled:u.resetBtnDisabled,onClick:d},{default:b(()=>[_(l(a(t)("Reset")),1)]),_:1},8,["disabled"])])}}});var ae=B(te,[["__scopeId","data-v-7854e1a2"]]);const F=m=>(Z("data-v-6dd53874"),m=m(),q(),m),se={class:"w2 gap-line"},le={class:"g-card-title"},oe={class:"card-num-group"},ne={class:"card-detail"},re={class:"card-num"},ie=F(()=>o("span",{class:"card-num-sub"},"%",-1)),ce={class:"card-desc"},de={class:"card-detail"},ue={class:"card-num"},ve={key:0,class:"card-num-sub"},pe={key:1,class:"card-num-sub"},_e={key:2,class:"card-num-sub"},me={class:"card-desc"},be={key:0,class:"card-num-sub"},ge={key:1,class:"card-num-sub"},he={key:2,class:"card-num-sub"},Ce=F(()=>o("span",{class:"line-split"},null,-1)),ye={class:"w2 gap-line"},Te={class:"g-card-title"},fe={class:"card-num-group"},ke={class:"card-detail"},Ae={class:"card-desc"},xe={class:"card-detail"},we={class:"card-num"},Re={class:"card-desc"},Se=F(()=>o("span",{class:"line-split"},null,-1)),Le={class:"w1 gap-line"},Ee={class:"g-card-title"},Pe={class:"card-num-group"},Fe={class:"card-detail"},Be={class:"card-num"},Ne=F(()=>o("span",{class:"card-num-sub"},"%",-1)),$e={class:"card-desc"},He=F(()=>o("span",{class:"line-split"},null,-1)),ze={class:"w1"},Qe={class:"g-card-title"},Me={class:"card-num-group"},Ve={class:"card-detail"},je={class:"card-num"},We={key:0,class:"card-num-sub"},Ge={key:1,class:"card-num-sub"},Ke=F(()=>o("span",{class:"card-num-sub"},"s",-1)),Ue={class:"card-desc"},Ye=x({__name:"overview-nums",props:N,setup(m){const v=m,{t}=P();G.extend(O);const i=T(!1),e=T({successExecuteCount:0,totalExecuteCount:0,totalCostTime:{s:0},totalSuccessRate:0,totalAvgCostTime:{s:0},resolvedDefectNum:0,repoCodeccAvgScore:0,qualityInterceptionRate:0,interceptionCount:0,totalQualityExecuteCount:0,turboSaveTime:{s:0}}),d=n=>{const c=G.duration(n),s=c.hours(),g=c.minutes(),h={s:c.seconds()};return g&&(h.m=g),s&&(h.h=s),h},p=()=>{i.value=!0,Promise.all([S.getPipelineSummaryData(v.status),S.getThirdpartySummaryData(v.status)]).then(([{pipelineSumInfoDO:n},{codeCheckInfo:c,qualityInfo:s,turboInfo:g}])=>{e.value.successExecuteCount=n==null?void 0:n.successExecuteCount,e.value.totalExecuteCount=n==null?void 0:n.totalExecuteCount,e.value.totalCostTime=d(n==null?void 0:n.totalCostTime),e.value.totalSuccessRate=n==null?void 0:n.totalSuccessRate,e.value.totalAvgCostTime=d(n==null?void 0:n.totalAvgCostTime),e.value.resolvedDefectNum=c==null?void 0:c.resolvedDefectNum,e.value.repoCodeccAvgScore=c==null?void 0:c.repoCodeccAvgScore,e.value.qualityInterceptionRate=s==null?void 0:s.qualityInterceptionRate,e.value.turboSaveTime=d((g==null?void 0:g.turboSaveTime)||0*1e3),e.value.interceptionCount=s==null?void 0:s.interceptionCount,e.value.totalQualityExecuteCount=s==null?void 0:s.totalExecuteCount}).finally(()=>{i.value=!1})},u=({data:n},{slots:c})=>[0,void 0,null].includes(n)?X("span",{class:"card-num"},"--"):c.default();return L(()=>v.status,p),$(p),(n,c)=>{const s=R("bk-popover"),g=R("bk-rate"),f=R("bk-loading");return C(),H(f,{class:"overview-nums overview-card mt20",loading:i.value},{default:b(()=>[o("section",se,[o("h3",le,l(a(t)("Pipeline runs")),1),o("section",oe,[o("section",ne,[o("h5",re,[r(u,{data:e.value.totalSuccessRate},{default:b(()=>[_(l(e.value.totalSuccessRate),1),ie]),_:1},8,["data"])]),o("span",ce,[_(l(a(t)("Success rate"))+" ",1),r(s,{placement:"top"},{content:b(()=>[_(l(a(t)("Success"))+": "+l(e.value.successExecuteCount||"--")+" / "+l(a(t)("No. of total runs"))+": "+l(e.value.totalExecuteCount||"--"),1)]),default:b(()=>[r(a(E.exports.InfoLine))]),_:1})])]),o("section",de,[o("h5",ue,[r(u,{data:e.value.totalAvgCostTime.s},{default:b(()=>[_(l(e.value.totalAvgCostTime.h),1),e.value.totalAvgCostTime.h?(C(),k("span",ve,"h")):w("",!0),_(l(e.value.totalAvgCostTime.m),1),e.value.totalAvgCostTime.m?(C(),k("span",pe,"m")):w("",!0),_(l(e.value.totalAvgCostTime.s),1),e.value.totalAvgCostTime.s?(C(),k("span",_e,"s")):w("",!0)]),_:1},8,["data"])]),o("span",me,[_(l(a(t)("Average time"))+" ",1),r(s,{placement:"top"},{content:b(()=>[_(l(a(t)("Total time"))+": "+l(e.value.totalCostTime.h),1),e.value.totalCostTime.h?(C(),k("span",be,"h")):w("",!0),_(l(e.value.totalCostTime.m),1),e.value.totalCostTime.m?(C(),k("span",ge,"m")):w("",!0),_(l(e.value.totalCostTime.s||"--"),1),e.value.totalCostTime.s?(C(),k("span",he,"s")):w("",!0),_(" / "+l(a(t)("No. of total runs"))+" : "+l(e.value.totalExecuteCount||"--"),1)]),default:b(()=>[r(a(E.exports.InfoLine))]),_:1})])]),Ce])]),o("section",ye,[o("h3",Te,l(a(t)("Code check")),1),o("section",fe,[o("section",ke,[r(u,{data:e.value.repoCodeccAvgScore},{default:b(()=>[r(g,{editable:!1,"model-value":e.value.repoCodeccAvgScore/20,size:"large",class:"card-num"},null,8,["model-value"])]),_:1},8,["data"]),o("span",Ae,[_(l(a(t)("Code Quality"))+" ",1),r(s,{placement:"top"},{content:b(()=>[_(l(a(t)("Code quality star based on Tencent Open Source Governance indicator system")),1)]),default:b(()=>[r(a(E.exports.InfoLine))]),_:1})])]),o("section",xe,[o("h5",we,[r(u,{data:e.value.resolvedDefectNum},{default:b(()=>[_(l(e.value.resolvedDefectNum),1)]),_:1},8,["data"])]),o("span",Re,[_(l(a(t)("Resolved Code Defects"))+" ",1),r(s,{placement:"top"},{content:b(()=>[_(l(a(t)("Resolved Code Defects")),1)]),default:b(()=>[r(a(E.exports.InfoLine))]),_:1})])]),Se])]),o("section",Le,[o("h3",Ee,l(a(t)("Quality Gate")),1),o("section",Pe,[o("section",Fe,[o("h5",Be,[r(u,{data:e.value.qualityInterceptionRate},{default:b(()=>[_(l(e.value.qualityInterceptionRate),1),Ne]),_:1},8,["data"])]),o("span",$e,[_(l(a(t)("Interception rate"))+" ",1),r(s,{placement:"top"},{content:b(()=>[_(l(a(t)("Intercepted"))+": "+l(e.value.interceptionCount||"--")+" / "+l(a(t)("No. of total runs"))+": "+l(e.value.totalQualityExecuteCount||"--"),1)]),default:b(()=>[r(a(E.exports.InfoLine))]),_:1})])]),He])]),o("section",ze,[o("h3",Qe,l(a(t)("Turbo")),1),o("section",Me,[o("section",Ve,[o("h5",je,[r(u,{data:e.value.turboSaveTime},{default:b(()=>[_(l(e.value.turboSaveTime.h),1),e.value.turboSaveTime.h?(C(),k("span",We,"h")):w("",!0),_(l(e.value.turboSaveTime.m),1),e.value.turboSaveTime.m?(C(),k("span",Ge,"m")):w("",!0),_(l(e.value.turboSaveTime.s),1),Ke]),_:1},8,["data"])]),o("span",Ue,[_(l(a(t)("Saving Time"))+" ",1),r(s,{placement:"top"},{content:b(()=>[_(l(a(t)("Time saved after using Turbo")),1)]),default:b(()=>[r(a(E.exports.InfoLine))]),_:1})])])])])]),_:1},8,["loading"])}}});var Je=B(Ye,[["__scopeId","data-v-6dd53874"]]),Xe=x({props:{data:Array,labels:Array,titles:Array},emits:["point-click","point-hover"],setup(m,{emit:v}){const t=T(null);let i;const e=()=>{i==null||i.destroy()},d=()=>{e();const{data:p,labels:u,titles:n}=m;i=new Q(t.value,{type:"line",data:{labels:u,datasets:p.map((c,s)=>({label:c.label,fill:!0,backgroundColor:c.backgroundColor||"rgba(43, 124, 255,0.3)",borderColor:c.borderColor||"rgba(43, 124, 255,1)",lineTension:0,borderWidth:2,pointRadius:2,pointHitRadius:3,pointHoverRadius:3,data:[...c.list],yAxisID:s===0?"y1":"y2",datalabels:{listeners:{leave:function(g){document.getElementsByClassName("double-line-canvas")[0].style.cursor="auto"}}}}))},options:{maintainAspectRatio:!1,responsive:!0,scale:{ticks:{stepSize:2}},plugins:{tooltip:{bodySpacing:10,mode:"x",intersect:!1,enableItemActive:!0,singleInRange:!0},legend:{position:"bottom",legendIcon:"arc",align:"center",labels:{padding:10,usePointStyle:!0,pointStyle:"dash"}},crosshair:{enabled:!0,mode:"x",style:{x:{enabled:!0,color:"#cde0ff",weight:1,borderStyle:"solid"},y:{enabled:!1}}}},scales:{y1:{position:"left",title:{display:!0,text:n[0],align:"start",color:"#979BA5"},scaleLabel:{display:!0,padding:0},grid:{drawTicks:!1,borderDash:[5,5]},ticks:{color:"#979BA5"},min:0},y2:{position:"right",title:{display:!0,text:n[1],align:"start",color:"#979BA5"},scaleLabel:{display:!0,padding:0},grid:{drawTicks:!1,borderDash:[5,5]},ticks:{color:"#979BA5"},min:0},x:{scaleLabel:{display:!0,padding:0},grid:{drawTicks:!1,display:!1}}},onClick(c,s){s.length>0&&v("point-click",s)},onHover(c,s){s.length>0&&v("point-hover",s)}}})};return L([m.data,m.labels],d),$(d),M(e),()=>r("div",{class:"canvas-wrapper"},[r("canvas",{ref:t,class:"double-line-canvas"},null)])}}),Ze=x({props:{data:Array,labels:Array,title:String},emits:["point-click","point-hover"],setup(m,{emit:v}){const t=T(null);let i;const e=()=>{i==null||i.destroy()},d=()=>{e();const{data:p,labels:u,title:n}=m;i=new Q(t.value,{type:"bar",data:{labels:u,datasets:p.map(c=>({label:c.label,backgroundColor:c.backgroundColor||"rgba(43, 124, 255,0.3)",borderColor:c.borderColor||"rgba(43, 124, 255,0.3)",borderSkipped:"bottom",borderWidth:1,data:[...c.list],datalabels:{listeners:{leave:function(s){document.getElementsByClassName("bar-canvas")[0].style.cursor="auto"}}}}))},options:{maintainAspectRatio:!1,responsive:!0,plugins:{tooltip:{bodySpacing:10,mode:"x",intersect:!1,enableItemActive:!0,singleInRange:!0},legend:{position:"bottom",legendIcon:"arc",align:"center",labels:{padding:10,usePointStyle:!0,pointStyle:"dash"}}},scale:{ticks:{stepSize:2}},scales:{y:{stacked:!0,title:{display:!0,text:n,align:"start"},grid:{drawTicks:!1,borderDash:[5,5]},min:0},x:{stacked:!0,grid:{drawTicks:!1,display:!1}}},onClick(c,s){s.length>0&&v("point-click",s)},onHover(c,s){s.length>0&&v("point-hover",s)}}})};return L(m,d),$(d),M(e),()=>r("div",{class:"canvas-wrapper"},[r("canvas",{class:"bar bar-canvas",ref:t},null)])}});const qe={class:"run-trend-card overview-card"},Ie={class:"g-card-title"},De={class:"run-trend-card overview-card"},Oe={class:"g-card-title"},et=x({__name:"run-trend",props:N,setup(m){const v=m,{t}=P(),i=T(!1),e=T({data:[{list:[],label:t("Total"),backgroundColor:"rgba(43, 124, 255,0.3)",borderColor:"rgba(43, 124, 255,1)"},{list:[],label:t("Failure"),backgroundColor:"rgba(255, 86, 86,0.3)",borderColor:"rgba(255, 86, 86, 1)"}],labels:[]}),d=T({data:[],labels:[]}),p=["#FF5656","#FF9700","#FFD695","#A73AFF"],u=I(),n=([{datasetIndex:h,index:A}])=>{h===1&&u.push({name:"FailAnalysis",query:{time:e.value.labels[A]}})},c=([{datasetIndex:h,index:A}])=>{h&&(document.getElementsByClassName("double-line-canvas")[0].style.cursor="pointer")},s=([{datasetIndex:h,index:A}])=>{u.push({name:"FailAnalysis",query:{errorType:d.value.data[h].errorType,time:d.value.labels[A]}})},g=([{datasetIndex:h,index:A}])=>{document.getElementsByClassName("bar-canvas")[0].style.cursor="pointer"},f=()=>{i.value=!0,Promise.all([S.getPipelineRunTimeTrend(v.status),S.getPipelineRunFailTrend(v.status)]).then(([{pipelineTrendInfo:h=[]},A])=>{h.forEach(y=>{e.value.data[0].list.push(y.totalExecuteCount),e.value.data[1].list.push(y.failedExecuteCount),e.value.labels.push(y.statisticsTime)}),A.forEach((y,j)=>{d.value.data.push({list:y.failInfos.map(z=>z.errorCount),label:y.name,errorType:y.errorType,backgroundColor:p[j],borderColor:p[j]}),d.value.labels=y.failInfos.map(z=>z.statisticsTime)})}).finally(()=>{i.value=!1})};return L(()=>v.status,()=>{e.value.data[0].list=[],e.value.data[1].list=[],e.value.labels=[],d.value.data=[],d.value.labels=[],f()}),V(f),(h,A)=>{const y=R("bk-loading");return C(),H(y,{class:"run-trend mt20",loading:i.value},{default:b(()=>[o("section",qe,[o("h3",Ie,l(a(t)("Pipeline run times trend")),1),r(a(Xe),{data:e.value.data,labels:e.value.labels,titles:[a(t)("Total runs"),a(t)("Failed runs")],onPointClick:n,onPointHover:c},null,8,["data","labels","titles"])]),o("section",De,[o("h3",Oe,l(a(t)("Pipeline run fails trend")),1),r(a(Ze),{data:d.value.data,labels:d.value.labels,title:a(t)("Run times"),onPointClick:s,onPointHover:g},null,8,["data","labels","title"])])]),_:1},8,["loading"])}}});var tt=B(et,[["__scopeId","data-v-26373ee8"]]),Y=x({props:{data:Array,labels:Array,title:String},setup(m){const v=T(null);let t;const i=()=>{t==null||t.destroy()},e=()=>{i();const{data:d,labels:p,title:u}=m;t=new Q(v.value,{type:"line",data:{labels:p,datasets:d==null?void 0:d.map(n=>({label:n.label,fill:!0,backgroundColor:n.backgroundColor||"rgba(43, 124, 255,0.3)",borderColor:n.borderColor||"rgba(43, 124, 255,1)",lineTension:0,borderWidth:2,pointRadius:2,pointHitRadius:3,pointHoverRadius:3,data:[...n.list]}))},options:{maintainAspectRatio:!1,responsive:!0,plugins:{tooltip:{bodySpacing:10,mode:"x",intersect:!1,enableItemActive:!0,singleInRange:!0},legend:{position:"bottom",legendIcon:"arc",align:"center",labels:{padding:10,usePointStyle:!0,pointStyle:"dash"}},crosshair:{enabled:!0,mode:"x",style:{x:{enabled:!0,color:"#cde0ff",weight:1,borderStyle:"solid"},y:{enabled:!1}}}},scales:{yAxes:{scaleLabel:{display:!0,padding:0},grid:{drawTicks:!1,borderDash:[5,5]},title:{display:!0,text:u,align:"start",color:"#979BA5"},ticks:{padding:10,color:"#979BA5"},min:0},xAxes:{scaleLabel:{display:!0,padding:0},grid:{drawTicks:!1,display:!1},ticks:{padding:10,sampleSize:20,autoSkip:!0,maxRotation:0}}}}})};return L([m.data,m.labels],e),$(e),M(i),()=>r("div",{class:"canvas-wrapper"},[r("canvas",{ref:v},null)])}});const at={class:"g-card-title"},st=x({__name:"time-trend",props:N,setup(m){const v=m,{t}=P(),i=T(!1),e=T({data:[{list:[],label:t("Average time (min)"),backgroundColor:"rgba(43, 124, 255,0.3)",borderColor:"rgba(43, 124, 255,1)"},{list:[],label:t("Average time of failure runs (min)"),backgroundColor:"rgba(255, 86, 86,0.3)",borderColor:"rgba(255, 86, 86, 1)"}],labels:[]}),d=()=>{i.value=!0,S.getPipelineRunTimeTrend(v.status).then(({pipelineTrendInfo:p})=>{p.forEach(u=>{e.value.data[0].list.push(u.totalAvgCostTime),e.value.data[1].list.push(u.failAvgCostTime),e.value.labels.push(u.statisticsTime)})}).finally(()=>{i.value=!1})};return L(()=>v.status,()=>{e.value.data[0].list=[],e.value.data[1].list=[],e.value.labels=[],d()}),V(d),(p,u)=>{const n=R("bk-loading");return C(),H(n,{class:"time-trend overview-card mt20",loading:i.value},{default:b(()=>[o("h3",at,l(a(t)("Average time trend")),1),r(a(Y),{data:e.value.data,labels:e.value.labels,title:a(t)("Average time (min)")},null,8,["data","labels","title"])]),_:1},8,["loading"])}}});var lt=B(st,[["__scopeId","data-v-3492810a"]]);const ot={class:"stage-time-title"},nt={class:"g-card-title"},rt=x({__name:"stage-time",props:N,emits:["change"],setup(m,{emit:v}){const t=m,{t:i}=P(),{handleChange:e}=K(v),d=T(!1),p=T([]),u=["167,58,255","218,165,32","0,206,209","255,215,0","210,105,30","165,42,42","255,222,173","255, 86, 86","255,151,0","43,124,255","12,227,144","255,209,93","205,92,92","128,128,0","255,0,255","3,168,158","218,112,214","199,97,20","85,102,0","255,128,0"],n=()=>{d.value=!0,S.getPipelineStageTrend(t.status).then(c=>{c.forEach(s=>{var f;const g={name:s==null?void 0:s.stageTagName,data:[],labels:[]};(f=s==null?void 0:s.pipelineStageAvgCostTimeInfos)==null||f.forEach((h,A)=>{g.data.push({list:h.stageAvgCostTimeInfos.map(y=>y.avgCostTime),label:h.pipelineName,backgroundColor:`rgba(${u[A]}, 0.3)`||"rgba(255, 86, 86,0.3)",borderColor:`rgba(${u[A]}, 1)`||"rgba(255, 86, 86, 1)"}),g.labels=h.stageAvgCostTimeInfos.map(y=>y.statisticsTime)}),p.value.push(g)})}).finally(()=>{d.value=!1,e(!1)})};return L(()=>t.status,()=>{p.value=[],n()}),V(n),(c,s)=>{const g=R("bk-loading");return C(),H(g,{class:"mt20 stage-average-time",loading:d.value},{default:b(()=>[o("h3",ot,l(a(i)("Stage average time trend")),1),(C(!0),k(U,null,D(p.value,f=>(C(),k("section",{class:"stage-card overview-card mt20",key:f.name},[o("h3",nt,l(f.name)+"\uFF08"+l(a(i)("Top 10"))+"\uFF09",1),r(a(Y),{data:f.data,labels:f.labels,title:a(i)("Average time (min)")},null,8,["data","labels","title"])]))),128))]),_:1},8,["loading"])}}});var it=B(rt,[["__scopeId","data-v-42905519"]]);const ct={class:"g-content"},_t=x({__name:"overview-main",setup(m){const{t:v}=P(),t=T({pipelineIds:[],pipelineLabelIds:[],startTime:"",endTime:""}),i=p=>{e.value=!0,t.value={...t.value,...p}},e=T(!1),d=p=>{e.value=p};return(p,u)=>(C(),k(U,null,[r(a(J),{title:a(v)("Overview")},null,8,["title"]),o("main",ct,[r(ae,{"reset-btn-disabled":e.value,status:t.value,onChange:i},null,8,["reset-btn-disabled","status"]),r(Je,{status:t.value},null,8,["status"]),r(tt,{status:t.value},null,8,["status"]),r(lt,{status:t.value},null,8,["status"]),r(it,{status:t.value,"reset-btn-disabled":e.value,onChange:d},null,8,["status","reset-btn-disabled"])])],64))}});export{_t as default};
