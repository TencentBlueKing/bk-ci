import{h as S,S as U,u as G,B as M,M as J}from"./bk-chart.min.0b6debc5.js";import{d as x,u as F,r as R,o as C,c as A,g as r,e as t,w as b,h as p,t as l,i as W,j as T,k as L,l as H,m as z,b as o,p as w,q as X,s as Z,v as q,x as V,y as D,z as j,f as I,F as K}from"./index.b20f0f2b.js";import{_ as N}from"./plugin-vue_export-helper.21dcd24c.js";import{d as O,i as P}from"./duration.b4b614d6.js";const $={status:Object,resetBtnDisabled:Boolean};const ee={class:"main-filter"},te=x({__name:"overview-filter",props:$,emits:["change"],setup(m,{emit:a}){const{t:i}=F(),d=a,{handleChange:e,handleTimeChange:u}=G(d),_=()=>{e({pipelineIds:[],pipelineLabelIds:[],startTime:"",endTime:""})},v=s=>s&&s.getTime()>Date.now();return(s,c)=>{const n=R("bk-date-picker"),g=R("bk-button");return C(),A("section",ee,[r(t(U),{class:"mr8 w240","id-key":"pipelineId","name-key":"pipelineName",placeholder:t(i)("Pipelines"),multiple:!0,"api-method":t(S).getPipelineList,"select-value":s.status.pipelineIds,onChange:c[0]||(c[0]=y=>t(e)({pipelineIds:y}))},null,8,["placeholder","api-method","select-value"]),r(t(U),{class:"mr8 w240","id-key":"labelId","name-key":"labelName",placeholder:t(i)("Pipeline Label"),multiple:!0,"api-method":t(S).getPipelineLabels,"select-value":s.status.pipelineLabelIds,onChange:c[1]||(c[1]=y=>t(e)({pipelineLabelIds:y}))},null,8,["placeholder","api-method","select-value"]),r(n,{class:"mr16 w240",type:"daterange","disable-date":v,"model-value":[s.status.startTime,s.status.endTime],onChange:t(u)},null,8,["model-value","onChange"]),r(g,{disabled:s.resetBtnDisabled,onClick:_},{default:b(()=>[p(l(t(i)("Reset")),1)]),_:1},8,["disabled"])])}}});var ae=N(te,[["__scopeId","data-v-6c02927e"]]);const B=m=>(Z("data-v-b17cf2ca"),m=m(),q(),m),se={class:"w2 gap-line"},le={class:"g-card-title"},oe={class:"card-num-group"},ne={class:"card-detail"},re={class:"card-num"},ie=B(()=>o("span",{class:"card-num-sub"},"%",-1)),ce={class:"card-desc"},de={class:"card-detail"},ue={class:"card-num"},ve={key:0,class:"card-num-sub"},_e={key:1,class:"card-num-sub"},pe={key:2,class:"card-num-sub"},me={class:"card-desc"},be={key:0,class:"card-num-sub"},ge={key:1,class:"card-num-sub"},he={key:2,class:"card-num-sub"},Ce=B(()=>o("span",{class:"line-split"},null,-1)),ye={class:"w2 gap-line"},Te={class:"g-card-title"},fe={class:"card-num-group"},ke={class:"card-detail"},Ae={class:"card-desc"},xe={class:"card-detail"},we={class:"card-num"},Re={class:"card-desc"},Se=B(()=>o("span",{class:"line-split"},null,-1)),Le={class:"w1 gap-line"},Ee={class:"g-card-title"},Pe={class:"card-num-group"},Fe={class:"card-detail"},Be={class:"card-num"},Ne=B(()=>o("span",{class:"card-num-sub"},"%",-1)),$e={class:"card-desc"},He=B(()=>o("span",{class:"line-split"},null,-1)),ze={class:"w1"},Qe={class:"g-card-title"},Me={class:"card-num-group"},Ve={class:"card-detail"},je={class:"card-num"},Ue={key:0,class:"card-num-sub"},We={key:1,class:"card-num-sub"},Ge=B(()=>o("span",{class:"card-num-sub"},"s",-1)),Ke={class:"card-desc"},Ye=x({__name:"overview-nums",props:$,setup(m){const{t:a}=F();W.extend(O);const i=m,d=T(!1),e=T({successExecuteCount:0,totalExecuteCount:0,totalCostTime:{s:0},totalSuccessRate:0,totalAvgCostTime:{s:0},resolvedDefectNum:0,repoCodeccAvgScore:0,qualityInterceptionRate:0,interceptionCount:0,totalQualityExecuteCount:0,turboSaveTime:{s:0}}),u=s=>{const c=W.duration(s),n=c.hours(),g=c.minutes(),h={s:c.seconds()};return g&&(h.m=g),n&&(h.h=n),h},_=()=>{d.value=!0,Promise.all([S.getPipelineSummaryData(i.status),S.getThirdpartySummaryData(i.status)]).then(([{pipelineSumInfoDO:s},{codeCheckInfo:c,qualityInfo:n,turboInfo:g}])=>{e.value.successExecuteCount=s==null?void 0:s.successExecuteCount,e.value.totalExecuteCount=s==null?void 0:s.totalExecuteCount,e.value.totalCostTime=u(s==null?void 0:s.totalCostTime),e.value.totalSuccessRate=s==null?void 0:s.totalSuccessRate,e.value.totalAvgCostTime=u(s==null?void 0:s.totalAvgCostTime),e.value.resolvedDefectNum=c==null?void 0:c.resolvedDefectNum,e.value.repoCodeccAvgScore=c==null?void 0:c.repoCodeccAvgScore,e.value.qualityInterceptionRate=n==null?void 0:n.qualityInterceptionRate,e.value.turboSaveTime=u((g==null?void 0:g.turboSaveTime)||0*1e3),e.value.interceptionCount=n==null?void 0:n.interceptionCount,e.value.totalQualityExecuteCount=n==null?void 0:n.totalExecuteCount}).finally(()=>{d.value=!1})},v=({data:s},{slots:c})=>[0,void 0,null].includes(s)?X("span",{class:"card-num"},"--"):c.default();return L(()=>i.status,_),H(_),(s,c)=>{const n=R("bk-popover"),g=R("bk-rate"),y=R("bk-loading");return C(),z(y,{class:"overview-nums overview-card mt20",loading:d.value},{default:b(()=>[o("section",se,[o("h3",le,l(t(a)("Pipeline runs")),1),o("section",oe,[o("section",ne,[o("h5",re,[r(v,{data:e.value.totalSuccessRate},{default:b(()=>[p(l(e.value.totalSuccessRate),1),ie]),_:1},8,["data"])]),o("span",ce,[p(l(t(a)("Success rate"))+" ",1),r(n,{placement:"top"},{content:b(()=>[p(l(t(a)("Success"))+": "+l(e.value.successExecuteCount||"--")+" / "+l(t(a)("No. of total runs"))+": "+l(e.value.totalExecuteCount||"--"),1)]),default:b(()=>[r(t(P.exports.InfoLine))]),_:1})])]),o("section",de,[o("h5",ue,[r(v,{data:e.value.totalAvgCostTime.s},{default:b(()=>[p(l(e.value.totalAvgCostTime.h),1),e.value.totalAvgCostTime.h?(C(),A("span",ve,"h")):w("",!0),p(l(e.value.totalAvgCostTime.m),1),e.value.totalAvgCostTime.m?(C(),A("span",_e,"m")):w("",!0),p(l(e.value.totalAvgCostTime.s),1),e.value.totalAvgCostTime.s?(C(),A("span",pe,"s")):w("",!0)]),_:1},8,["data"])]),o("span",me,[p(l(t(a)("Average time"))+" ",1),r(n,{placement:"top"},{content:b(()=>[p(l(t(a)("Total time"))+": "+l(e.value.totalCostTime.h),1),e.value.totalCostTime.h?(C(),A("span",be,"h")):w("",!0),p(l(e.value.totalCostTime.m),1),e.value.totalCostTime.m?(C(),A("span",ge,"m")):w("",!0),p(l(e.value.totalCostTime.s||"--"),1),e.value.totalCostTime.s?(C(),A("span",he,"s")):w("",!0),p(" / "+l(t(a)("No. of total runs"))+" : "+l(e.value.totalExecuteCount||"--"),1)]),default:b(()=>[r(t(P.exports.InfoLine))]),_:1})])]),Ce])]),o("section",ye,[o("h3",Te,l(t(a)("Code check")),1),o("section",fe,[o("section",ke,[r(v,{data:e.value.repoCodeccAvgScore},{default:b(()=>[r(g,{editable:!1,"model-value":e.value.repoCodeccAvgScore/20,size:"large",class:"card-num"},null,8,["model-value"])]),_:1},8,["data"]),o("span",Ae,[p(l(t(a)("Code Quality"))+" ",1),r(n,{placement:"top"},{content:b(()=>[p(l(t(a)("Code quality star based on Tencent Open Source Governance indicator system")),1)]),default:b(()=>[r(t(P.exports.InfoLine))]),_:1})])]),o("section",xe,[o("h5",we,[r(v,{data:e.value.resolvedDefectNum},{default:b(()=>[p(l(e.value.resolvedDefectNum),1)]),_:1},8,["data"])]),o("span",Re,[p(l(t(a)("Resolved Code Defects"))+" ",1),r(n,{placement:"top"},{content:b(()=>[p(l(t(a)("Resolved Code Defects")),1)]),default:b(()=>[r(t(P.exports.InfoLine))]),_:1})])]),Se])]),o("section",Le,[o("h3",Ee,l(t(a)("Quality Gate")),1),o("section",Pe,[o("section",Fe,[o("h5",Be,[r(v,{data:e.value.qualityInterceptionRate},{default:b(()=>[p(l(e.value.qualityInterceptionRate),1),Ne]),_:1},8,["data"])]),o("span",$e,[p(l(t(a)("Unqualified rate"))+" ",1),r(n,{placement:"top"},{content:b(()=>[p(l(t(a)("Unqualified"))+": "+l(e.value.interceptionCount||"--")+" / "+l(t(a)("No. of total runs"))+": "+l(e.value.totalQualityExecuteCount||"--"),1)]),default:b(()=>[r(t(P.exports.InfoLine))]),_:1})])]),He])]),o("section",ze,[o("h3",Qe,l(t(a)("Turbo")),1),o("section",Me,[o("section",Ve,[o("h5",je,[r(v,{data:e.value.turboSaveTime},{default:b(()=>[p(l(e.value.turboSaveTime.h),1),e.value.turboSaveTime.h?(C(),A("span",Ue,"h")):w("",!0),p(l(e.value.turboSaveTime.m),1),e.value.turboSaveTime.m?(C(),A("span",We,"m")):w("",!0),p(l(e.value.turboSaveTime.s),1),Ge]),_:1},8,["data"])]),o("span",Ke,[p(l(t(a)("Saving Time"))+" ",1),r(n,{placement:"top"},{content:b(()=>[p(l(t(a)("Time saved after using Turbo")),1)]),default:b(()=>[r(t(P.exports.InfoLine))]),_:1})])])])])]),_:1},8,["loading"])}}});var Je=N(Ye,[["__scopeId","data-v-b17cf2ca"]]),Xe=x({props:{data:Array,labels:Array,titles:Array},emits:["point-click","point-hover"],setup(m,{emit:a}){const i=T(null);let d;const e=()=>{d==null||d.destroy()},u=()=>{e();const{data:_,labels:v,titles:s}=m;d=new M(i.value,{type:"line",data:{labels:v,datasets:_.map((c,n)=>({label:c.label,fill:!0,backgroundColor:c.backgroundColor||"rgba(43, 124, 255,0.3)",borderColor:c.borderColor||"rgba(43, 124, 255,1)",lineTension:0,borderWidth:2,pointRadius:2,pointHitRadius:3,pointHoverRadius:3,data:[...c.list],yAxisID:n===0?"y1":"y2",datalabels:{listeners:{leave:function(g){document.getElementsByClassName("double-line-canvas")[0].style.cursor="auto"}}}}))},options:{maintainAspectRatio:!1,responsive:!0,scale:{ticks:{stepSize:2}},plugins:{tooltip:{bodySpacing:10,mode:"x",intersect:!1,enableItemActive:!0,singleInRange:!0},legend:{position:"bottom",legendIcon:"arc",align:"center",labels:{padding:10,usePointStyle:!0,pointStyle:"dash"}},crosshair:{enabled:!0,mode:"x",style:{x:{enabled:!0,color:"#cde0ff",weight:1,borderStyle:"solid"},y:{enabled:!1}}}},scales:{y1:{position:"left",title:{display:!0,text:s[0],align:"start",color:"#979BA5"},scaleLabel:{display:!0,padding:0},grid:{drawTicks:!1,borderDash:[5,5]},ticks:{color:"#979BA5"},min:0},y2:{position:"right",title:{display:!0,text:s[1],align:"start",color:"#979BA5"},scaleLabel:{display:!0,padding:0},grid:{drawTicks:!1,borderDash:[5,5]},ticks:{color:"#979BA5"},min:0},x:{scaleLabel:{display:!0,padding:0},grid:{drawTicks:!1,display:!1}}},onClick(c,n){n.length>0&&a("point-click",n)},onHover(c,n){n.length>0&&a("point-hover",n)}}})};return L([m.data,m.labels],u),H(u),V(e),()=>r("div",{class:"canvas-wrapper"},[r("canvas",{ref:i,class:"double-line-canvas"},null)])}}),Ze=x({props:{data:Array,labels:Array,title:String},emits:["point-click","point-hover"],setup(m,{emit:a}){const i=T(null);let d;const e=()=>{d==null||d.destroy()},u=()=>{e();const{data:_,labels:v,title:s}=m;d=new M(i.value,{type:"bar",data:{labels:v,datasets:_.map(c=>({label:c.label,backgroundColor:c.backgroundColor||"rgba(43, 124, 255,0.3)",borderColor:c.borderColor||"rgba(43, 124, 255,0.3)",borderSkipped:"bottom",borderWidth:1,data:[...c.list],datalabels:{listeners:{leave:function(n){document.getElementsByClassName("bar-canvas")[0].style.cursor="auto"}}}}))},options:{maintainAspectRatio:!1,responsive:!0,plugins:{tooltip:{bodySpacing:10,mode:"x",intersect:!1,enableItemActive:!0,singleInRange:!0},legend:{position:"bottom",legendIcon:"arc",align:"center",labels:{padding:10,usePointStyle:!0,pointStyle:"dash"}}},scale:{ticks:{stepSize:2}},scales:{y:{stacked:!0,title:{display:!0,text:s,align:"start"},grid:{drawTicks:!1,borderDash:[5,5]},min:0},x:{stacked:!0,grid:{drawTicks:!1,display:!1}}},onClick(c,n){n.length>0&&a("point-click",n)},onHover(c,n){n.length>0&&a("point-hover",n)}}})};return L(m,u),H(u),V(e),()=>r("div",{class:"canvas-wrapper"},[r("canvas",{class:"bar bar-canvas",ref:i},null)])}});const qe={class:"run-trend-card overview-card"},De={class:"g-card-title"},Ie={class:"run-trend-card overview-card"},Oe={class:"g-card-title"},et=x({__name:"run-trend",props:$,setup(m){const{t:a}=F(),i=m,d=T(!1),e=T({data:[{list:[],label:a("Total"),backgroundColor:"rgba(43, 124, 255,0.3)",borderColor:"rgba(43, 124, 255,1)"},{list:[],label:a("Failure"),backgroundColor:"rgba(255, 86, 86,0.3)",borderColor:"rgba(255, 86, 86, 1)"}],labels:[]}),u=T({data:[],labels:[]}),_=["#FF5656","#FF9700","#FFD695","#A73AFF"],v=D(),s=([{datasetIndex:h,index:k}])=>{h===1&&v.push({name:"FailAnalysis",query:{time:e.value.labels[k]}})},c=([{datasetIndex:h,index:k}])=>{h&&(document.getElementsByClassName("double-line-canvas")[0].style.cursor="pointer")},n=([{datasetIndex:h,index:k}])=>{v.push({name:"FailAnalysis",query:{errorType:u.value.data[h].errorType,time:u.value.labels[k]}})},g=([{datasetIndex:h,index:k}])=>{document.getElementsByClassName("bar-canvas")[0].style.cursor="pointer"},y=()=>{d.value=!0,Promise.all([S.getPipelineRunTimeTrend(i.status),S.getPipelineRunFailTrend(i.status)]).then(([{pipelineTrendInfo:h=[]},k])=>{h.forEach(f=>{e.value.data[0].list.push(f.totalExecuteCount),e.value.data[1].list.push(f.failedExecuteCount),e.value.labels.push(f.statisticsTime)}),k.forEach((f,E)=>{u.value.data.push({list:f.failInfos.map(Q=>Q.errorCount),label:f.name,errorType:f.errorType,backgroundColor:_[E],borderColor:_[E]}),u.value.labels=f.failInfos.map(Q=>Q.statisticsTime)})}).finally(()=>{d.value=!1})};return L(()=>i.status,()=>{e.value.data[0].list=[],e.value.data[1].list=[],e.value.labels=[],u.value.data=[],u.value.labels=[],y()}),j(y),(h,k)=>{const f=R("bk-loading");return C(),z(f,{class:"run-trend mt20",loading:d.value},{default:b(()=>[o("section",qe,[o("h3",De,l(t(a)("Pipeline run times trend")),1),r(t(Xe),{data:e.value.data,labels:e.value.labels,titles:[t(a)("Total runs"),t(a)("Failed runs")],onPointClick:s,onPointHover:c},null,8,["data","labels","titles"])]),o("section",Ie,[o("h3",Oe,l(t(a)("Pipeline run fails trend")),1),r(t(Ze),{data:u.value.data,labels:u.value.labels,title:t(a)("Run times"),onPointClick:n,onPointHover:g},null,8,["data","labels","title"])])]),_:1},8,["loading"])}}});var tt=N(et,[["__scopeId","data-v-26373ee8"]]),Y=x({props:{data:Array,labels:Array,title:String},setup(m){const a=T(null);let i;const d=()=>{i==null||i.destroy()},e=()=>{d();const{data:u,labels:_,title:v}=m;i=new M(a.value,{type:"line",data:{labels:_,datasets:u==null?void 0:u.map(s=>({label:s.label,fill:!0,backgroundColor:s.backgroundColor||"rgba(43, 124, 255,0.3)",borderColor:s.borderColor||"rgba(43, 124, 255,1)",lineTension:0,borderWidth:2,pointRadius:2,pointHitRadius:3,pointHoverRadius:3,data:[...s.list]}))},options:{maintainAspectRatio:!1,responsive:!0,plugins:{tooltip:{bodySpacing:10,mode:"x",intersect:!1,enableItemActive:!0,singleInRange:!0},legend:{position:"bottom",legendIcon:"arc",align:"center",labels:{padding:10,usePointStyle:!0,pointStyle:"dash"}},crosshair:{enabled:!0,mode:"x",style:{x:{enabled:!0,color:"#cde0ff",weight:1,borderStyle:"solid"},y:{enabled:!1}}}},scales:{yAxes:{scaleLabel:{display:!0,padding:0},grid:{drawTicks:!1,borderDash:[5,5]},title:{display:!0,text:v,align:"start",color:"#979BA5"},ticks:{padding:10,color:"#979BA5"},min:0},xAxes:{scaleLabel:{display:!0,padding:0},grid:{drawTicks:!1,display:!1},ticks:{padding:10,sampleSize:20,autoSkip:!0,maxRotation:0}}}}})};return L([m.data,m.labels],e),H(e),V(d),()=>r("div",{class:"canvas-wrapper"},[r("canvas",{ref:a},null)])}});const at={class:"g-card-title"},st=x({__name:"time-trend",props:$,setup(m){const{t:a}=F(),i=m,d=T(!1),e=T({data:[{list:[],label:a("Average time (min)"),backgroundColor:"rgba(43, 124, 255,0.3)",borderColor:"rgba(43, 124, 255,1)"},{list:[],label:a("Average time of failure runs (min)"),backgroundColor:"rgba(255, 86, 86,0.3)",borderColor:"rgba(255, 86, 86, 1)"}],labels:[]}),u=()=>{d.value=!0,S.getPipelineRunTimeTrend(i.status).then(({pipelineTrendInfo:_})=>{_.forEach(v=>{e.value.data[0].list.push(v.totalAvgCostTime),e.value.data[1].list.push(v.failAvgCostTime),e.value.labels.push(v.statisticsTime)})}).finally(()=>{d.value=!1})};return L(()=>i.status,()=>{e.value.data[0].list=[],e.value.data[1].list=[],e.value.labels=[],u()}),j(u),(_,v)=>{const s=R("bk-loading");return C(),z(s,{class:"time-trend overview-card mt20",loading:d.value},{default:b(()=>[o("h3",at,l(t(a)("Average time trend")),1),r(t(Y),{data:e.value.data,labels:e.value.labels,title:t(a)("Average time (min)")},null,8,["data","labels","title"])]),_:1},8,["loading"])}}});var lt=N(st,[["__scopeId","data-v-3492810a"]]);const ot={class:"stage-time-title"},nt={class:"g-card-title"},rt=x({__name:"stage-time",props:$,emits:["change"],setup(m,{emit:a}){const{t:i}=F(),d=m,e=a,{handleChange:u}=G(e),_=T(!1),v=T([]),s=["167,58,255","218,165,32","0,206,209","255,215,0","210,105,30","165,42,42","255,222,173","255, 86, 86","255,151,0","43,124,255","12,227,144","255,209,93","205,92,92","128,128,0","255,0,255","3,168,158","218,112,214","199,97,20","85,102,0","255,128,0"],c=()=>{_.value=!0,S.getPipelineStageTrend(d.status).then(n=>{n.forEach(g=>{var h;const y={name:g==null?void 0:g.stageTagName,data:[],labels:[]};(h=g==null?void 0:g.pipelineStageAvgCostTimeInfos)==null||h.forEach((k,f)=>{y.data.push({list:k.stageAvgCostTimeInfos.map(E=>E.avgCostTime),label:k.pipelineName,backgroundColor:`rgba(${s[f]}, 0.3)`||"rgba(255, 86, 86,0.3)",borderColor:`rgba(${s[f]}, 1)`||"rgba(255, 86, 86, 1)"}),y.labels=k.stageAvgCostTimeInfos.map(E=>E.statisticsTime)}),v.value.push(y)})}).finally(()=>{_.value=!1,u(!1)})};return L(()=>d.status,()=>{v.value=[],c()}),j(c),(n,g)=>{const y=R("bk-loading");return C(),z(y,{class:"mt20 stage-average-time",loading:_.value},{default:b(()=>[o("h3",ot,l(t(i)("Average Duration Trend by Stage")),1),(C(!0),A(K,null,I(v.value,h=>(C(),A("section",{class:"stage-card overview-card mt20",key:h.name},[o("h3",nt,l(h.name)+"\uFF08"+l(t(i)("Top 10"))+"\uFF09",1),r(t(Y),{data:h.data,labels:h.labels,title:t(i)("Average time (min)")},null,8,["data","labels","title"])]))),128))]),_:1},8,["loading"])}}});var it=N(rt,[["__scopeId","data-v-ac50d76a"]]);const ct={class:"g-content"},pt=x({__name:"overview-main",setup(m){const{t:a}=F(),i=T({pipelineIds:[],pipelineLabelIds:[],startTime:"",endTime:""}),d=_=>{e.value=!0,i.value={...i.value,..._}},e=T(!1),u=_=>{e.value=_};return(_,v)=>(C(),A(K,null,[r(t(J),{title:t(a)("Overview")},null,8,["title"]),o("main",ct,[r(ae,{"reset-btn-disabled":e.value,status:i.value,onChange:d},null,8,["reset-btn-disabled","status"]),r(Je,{status:i.value},null,8,["status"]),r(tt,{status:i.value},null,8,["status"]),r(lt,{status:i.value},null,8,["status"]),r(it,{status:i.value,"reset-btn-disabled":e.value,onChange:u},null,8,["status","reset-btn-disabled"])])],64))}});export{pt as default};
