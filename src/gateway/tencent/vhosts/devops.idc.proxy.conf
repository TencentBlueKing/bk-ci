# IDC PROXY网关转发到RIO应用网关
location / {
    # 设置变量
    set_by_lua_block $domain {
        return string.gsub(ngx.var.host, "idc%.", "devnet-backend.")
    }
    set_by_lua_block $gw_token {
        return ngx.req.get_headers()["X-DEVOPS-TOKEN"] or config.gw_token or "null"
    }

    # 设置rio网关header
    set $timestamp '';
    set $signature '';
    set $riodomain '';
    access_by_lua_file 'conf/lua/rio/rio_devops.lua';

    # 头部
    proxy_set_header Host $domain;
    proxy_set_header Timestamp $timestamp;
    proxy_set_header Signature $signature;
    proxy_set_header x-rio-seq "";
    proxy_set_header X-DEVOPS-TOKEN $gw_token;
    include proxy.set.header.common.conf;

    # 反向代理到目标ip，端口，路径和参数
    proxy_pass http://$riodomain$request_uri;
}
