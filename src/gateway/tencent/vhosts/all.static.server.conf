# 静态页面网站的配置文件

#pre-ci
server {
    include server.common.conf;
    access_log /data/bkee/logs/ci/nginx/static.preci.access.$log_date.log devops_format;
    error_log /data/bkee/logs/ci/nginx/static.preci.error.log;

    server_name preci.woa.com pre-ci.woa.com pre-ci.oa.com preci.oa.com;
    listen 80;

    root /data/bkee/ci/static/preci;

    location / {
        add_header Cache-Control no-store;
        index index.html index.htm;
        try_files $uri @fallback;
    }

    location @fallback {
        header_filter_by_lua_file 'conf/lua/cors_filter.lua';
        add_header Cache-Control no-store;
        rewrite .* /index.html break;
    }
}

#git-ci
server {
    include server.common.conf;
    access_log /data/bkee/logs/ci/nginx/static.gitci.access.$log_date.log devops_format;
    error_log /data/bkee/logs/ci/nginx/static.gitci.error.log;

    server_name dev.git-ci.woa.com test.git-ci.woa.com git-ci.woa.com stream.woa.com dev.stream.woa.com test.stream.woa.com;
    listen 80;

    set $project "stream";

    include gray.conf;

    #后台的网关特殊路径
    include vhosts/devops.backend.special.conf;

    #bkrepo的网关路径
    include vhosts/devops.artifactory.bkrepo.conf;

    #后台路径
    include backend.conf;

    # 前端 默认
    root $static_dir/stream;
    location / {
        add_header Cache-Control no-store;
        index index.html index.htm;
        try_files $uri @fallback;
    }
    location @fallback {
        header_filter_by_lua_file 'conf/lua/cors_filter.lua';
        add_header Cache-Control no-store;
        rewrite .* /index.html break;
    }

    # 前端 metrics特殊处理
    location /metrics/ {
        add_header Cache-Control no-store;
        index index.html index.htm;
        root $static_dir;
        try_files $uri @fallback_metrics;
    }
    location @fallback_metrics {
        root $static_dir/metrics;
        header_filter_by_lua_file 'conf/lua/cors_filter.lua';
        add_header Cache-Control no-store;
        rewrite .* /index.html break;
    }
}
